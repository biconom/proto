# Сервис: TradeService

## 1. Описание

**`TradeService`** — это основной клиентский сервис для выполнения торговых операций (например, в обменнике). Он спроектирован с упором на предсказуемость и прозрачность для пользователя.

Сервис предоставляет два основных метода:
1.  **`ValidateTrade`**: Для предварительной проверки и расчета сделки **без ее исполнения**.
2.  **`CreateTrade`**: Для фактического исполнения сделки.

## 2. Описание методов (RPC)

### `rpc ValidateTrade(TradeRequest) returns (TradeDetails)`
- **Назначение**: Проверить возможность совершения сделки и получить ее предварительный расчет. **Этот метод не изменяет баланс пользователя.**
- **Использование**: Вызывается, когда пользователь вводит сумму для обмена и хочет увидеть, сколько он получит и какие будут комиссии, перед тем как нажать кнопку "Обменять". Метод выполняет все проверки: достаточность баланса, лимиты, права доступа.
- **Параметры `TradeRequest`**:
  - `pair_id`: Какую пару на какой бирже торгуем.
  - `source_wallet_type_id`: С какого кошелька списываем.
  - `destination_wallet_type_id`: На какой кошелек зачисляем.
  - `operation`: Определяет направление сделки и сумму. Используется `oneof` с полями `buy_with_quote` (потратить котируемую валюту) или `sell_base` (продать базовую валюту).
- **Ответ `TradeDetails`**:
  - `amount_to_receive`: Итоговая сумма, которую пользователь получит.
  - `fees`: Прозрачная и подробная детализация всех комиссий. Представляет собой `map`, где ключ — это ID валюты, а значение — структура с общей суммой и детализацией по каждой составляющей комиссии.
- **Авторизация**: Требуется.

- **Ошибки**: Если сделка невозможна, метод вернет ошибку с объяснением причины (например, `FAILED_PRECONDITION` "недостаточно средств").

### `rpc CreateTrade(TradeRequest) returns (TradeResult)`
- **Назначение**: Исполнить торговую операцию.
- **Использование**: Вызывается, когда пользователь нажимает финальную кнопку "Обменять".
- **Параметры `TradeRequest`**: Принимает те же параметры, что и `ValidateTrade`.
- **Ответ `TradeResult`**:
  - `id`: Уникальный ID исполненной сделки.
  - `details`: Полная информация об исполненной сделке (суммы, комиссии, курс).
- **Авторизация**: Требуется.

## 3. Права доступа

Все методы сервиса требуют авторизации, так как они работают с балансами и операциями конкретного пользователя.