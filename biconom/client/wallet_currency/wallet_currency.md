# Сервис: WalletCurrencyService

## 1. Описание

**`WalletCurrencyService`** — это клиентский сервис, который предоставляет авторизованному пользователю детализированную информацию о его балансах (`WalletCurrency`), а также предоставляет полный набор методов для выполнения внутренних переводов и вывода средств.

## 2. Описание методов (RPC)

### Методы для получения информации о балансах

### `rpc Get(biconom.types.WalletCurrency.Id) returns (biconom.types.WalletCurrency)`
- **Назначение**: Получить полную информацию о балансе конкретной валюты в конкретном типе кошелька.
- **Использование**: Полезно для обновления данных по одному активу на UI.
- **Параметры**: Принимает `biconom.types.WalletCurrency.Id` (составной ключ из `wallet_type_id` и `currency_id`).
- **Ответ**: Возвращает модель `biconom.types.WalletCurrency` с подтвержденным балансом и сводкой по операциям в ожидании.
- **Авторизация**: Требуется.

### `rpc List(ListRequest) returns (biconom.types.WalletCurrency.List)`
- **Назначение**: Получить список балансов пользователя с возможностью фильтрации.
- **Использование**:
  - Получить все балансы пользователя в "Спотовом" кошельке.
  - Получить баланс BTC во всех кошельках пользователя.
- **Параметры `ListRequest`**:
  - `repeated filter_wallet_type_ids`: Фильтр по одному или нескольким типам кошельков.
  - `repeated filter_currency_ids`: Фильтр по одной или нескольким валютам.
- **Ответ**: Возвращает `biconom.types.WalletCurrency.List`, содержащий отфильтрованный список балансов.
- **Авторизаци**: Требуется.

### Методы для управления внутренними переводами

### `rpc Transfer(TransferRequest) returns (TransferResult)`
- **Назначение**: Выполнить внутренний перевод средств от текущего пользователя другому пользователю системы.
- **Использование**: Основной метод для отправки средств между пользователями.
- **Параметры `TransferRequest`**:
  - `source`: С какого баланса (кошелек + валюта) списать средства.
  - `amount`: Сумма для перевода.
  - `recipient`: Идентификатор получателя. Можно указать либо `account_id`, либо `distributor_id`.
  - `memo`: Необязательное текстовое примечание к переводу.
- **Ответ**: Возвращает ID созданной транзакции (`LedgerTransaction.Id`).
- **Авторизация**: Требуется.

### Методы для управления выводом средств

### `rpc WithdrawalStateGet(WithdrawalStateGetRequest) returns (WithdrawalStateGetResponse)`
- **Назначение**: Проверить общее состояние сервиса вывода для конкретного актива (кошелек + валюта + сеть).
- **Использование**: Вызывается перед началом процесса вывода, чтобы понять, доступна ли операция, и получить контекст (например, последний использованный адрес).
- **Ответ**: Возвращает статус (`AVAILABLE`, `MAINTENANCE`, `TIME_RESTRICTED` и т.д.), последний активный адрес из "белого списка" и время, когда вывод станет доступен (если он ограничен).

### `rpc WithdrawalCreate(biconom.types.PaymentNetworkCurrencyWithdrawal.Body) returns (biconom.types.Confirmation)`
- **Назначение**: Инициировать процесс вывода средств с баланса кошелька. Метод принимает тело заявки, создает ее в системе со статусом `PENDING_CONFIRMATION` и возвращает форму для подтверждения.
- **Использование**: Это первый шаг в процессе вывода. После вызова этого метода клиент должен отобразить пользователю полученную форму `Confirmation`. Сама заявка будет отправлена на обработку только после успешного прохождения этой формы.
- **Параметры**: Принимает `PaymentNetworkCurrencyWithdrawal.Body` со всеми деталями вывода (кошелек, валюта, сумма, реквизиты и т.д.).
- **Ответ**: Возвращает `biconom.types.Confirmation`, которую необходимо подтвердить через `ConfirmationService`.
- **Авторизация**: Требуется.
