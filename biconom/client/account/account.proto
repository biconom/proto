syntax = "proto3";

package biconom.client.account;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "biconom/types/account.proto";
import "biconom/types/distributor.proto";
import "biconom/types/mnemonic.proto";
import "biconom/types/marketing_slot.proto";
import "biconom/types/payment_destination.proto";
import "biconom/types/google_authenticator.proto";

// AccountService предоставляет информацию о текущем аутентифицированном аккаунте.
service AccountService {
	// Получает сводную информацию о текущем (авторизованном) аккаунте, включая список его дистрибьюторов.
	rpc GetCurrent(GetCurrentRequest) returns (AccountView);
}

message GetCurrentRequest {
	optional uint32 distributor_upline_visibility_depth = 1;
}

// AccountView представляет собой сводную информацию о текущем аккаунте.
message AccountView {
	message Distributor {
		biconom.types.Distributor value = 1;
		repeated biconom.types.Distributor upline_distributors = 2;
		repeated biconom.types.MarketingSlot.State slot_states = 3;
	}
	uint32 executor_account_id = 1;
	repeated biconom.types.Account accounts = 2;
	// Список дистрибьюторов, принадлежащих авторизованному аккаунту.
	repeated Distributor distributors = 3;

	oneof profile {
		// Профиль user, связанном с этим аккаунтом.
		UserProfile user_profile = 4;
		// Информация о community, связанном с этим аккаунтом.
		google.protobuf.Empty community_profile = 5;
	}
}

message UserProfile {
	// Информация об электронной почте пользователя.
	message Email {
		string value = 1; // Email адрес.
		google.protobuf.Timestamp created_at = 2; // Дата установки email.
	}

	// Информация о пароле пользователя.
	message Password {
		uint32 password_policy_id = 1; // ID политики
		google.protobuf.Timestamp created_at = 2; // Дата последней смены пароля.
	}

	// Информация об telegram пользователя.
	message Telegram {
		int64 telegram_user_id = 1;
		string telegram_username = 2;
		google.protobuf.Timestamp created_at = 3; // Дата установки telegram.
	}

	optional Email email = 1; // Информация о почте.
	optional Password password = 2; // Информация о пароле.
	biconom.types.Mnemonic mnemonic = 3; // Состояние mnemonic.
	biconom.types.GoogleAuthenticator google_authenticator = 4; // Состояние 2FA.
	repeated biconom.types.PaymentDestination payment_destinations = 5; // Активные платежные реквизиты.
	uint32 locale_id = 6; // Текущая локаль.
	optional Telegram telegram = 7; // Информация о telegram.
}