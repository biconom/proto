syntax = "proto3";

package biconom.client.analytics;

import "google/protobuf/empty.proto";
import "biconom/types/chart.proto";
import "biconom/types/interval.proto";

// AnalyticsService предоставляет методы для получения аналитических данных, таких как графики.
service AnalyticsService {
    // Получает один график по его идентификатору и параметрам.
    rpc GetChart(GetChartRequest) returns (biconom.types.Chart);

    // Получает список графиков по их идентификаторам и параметрам в одном пакетном запросе.
    rpc GetCharts(GetChartRequest.List) returns (biconom.types.Chart.List);

    // Получает суммарную статистику.
    rpc GetSummary(google.protobuf.Empty) returns (SummaryStatisticsResponse);
}

// Запрос на получение одного графика.
message GetChartRequest {
    // 'List' представляет собой запрос на получение нескольких графиков.
    message List {
        repeated GetChartRequest items = 1;
    }

    // Логическое имя (идентификатор) графика (например, "income", "registrations").
    string chart_name = 1;

    // Произвольный строковый идентификатор, устанавливаемый клиентом.
    // Позволяет различать несколько запросов на один и тот же тип графика с разными параметрами.
    // Этот же идентификатор будет возвращен в ответе `biconom.types.Chart`.
    optional string custom_id = 2;

    // Идентификатор валюты. Если указан, запрашивается монетарный график (например, "income" для USDT).
    // Если не указан, запрашивается количественный график (например, "registrations").
    optional uint32 currency_id = 3;

    // 'ScopeOptions' определяет область видимости данных для графика.
    message ScopeOptions {
        // 'Id' представляет собой перечисление доступных областей видимости.
        enum Id {
            UNSPECIFIED = 0;
            // Только персональные данные.
            PERSONAL = 1;
            // Данные по команде (структуре) дистрибьютора.
            TEAM = 2;
            // Данные по всей компании.
            COMPANY_WIDE = 3;
        }

        // Выбранная область видимости данных.
        Id id = 1;

        // Максимальная глубина структуры, которую нужно включить в отчет (начиная с текущего пользователя).
        // Если не указана, включается вся доступная глубина.
        optional uint32 team_depth_limit = 2;

        // Включать ли персональные данные в отчет по команде.
        // Если true, в отчет будут включены данные текущего пользователя и его структуры.
        // Если false, в отчет будут включены только данные структуры (без данных пользователя).
        bool include_personal = 3;
    }

    // Область видимости данных для графика.
    ScopeOptions scope = 4;

    // Интервал агрегации данных (таймфрейм).
    biconom.types.Interval interval = 5;

    // Начало временного диапазона для запроса данных (Unix timestamp).
    uint32 timestamp_start = 6;

    // Конец временного диапазона для запроса данных (Unix timestamp).
    uint32 timestamp_end = 7;
}

// Ответ на запрос суммарной статистики.
message SummaryStatisticsResponse {
    // Суммарная статистика для одной валюты.
    message CurrencySummary {
        // Статистика по конкретной платежной сети.
        message PaymentNetworkSummary {
            // Идентификатор платежной сети.
            uint32 payment_network_id = 1;

            // Общая сумма пополнений через эту платежную сеть.
            string total_deposit = 2;

            // Суммарная комиссия (сбор) за пополнения.
            string total_deposit_fee = 3;

            // Общая сумма выводов через эту платежную сеть.
            string total_withdrawal = 4;

            // Суммарная комиссия (сбор) за выводы.
            string total_withdrawal_fee = 5;

            // Количество денежных средств на горячем кошельке.
            optional string hot_wallet_balance = 6;
        }

        // Идентификатор валюты.
        uint32 currency_id = 1;

        // Общая сумма средств пользователей в данной валюте на их счетах.
        string total_user_balance = 2;

        // Статистика по каждой платежной сети для данной валюты.
        repeated PaymentNetworkSummary payment_network_stats = 3;
    }

    // Список суммарных статистик по каждой валюте.
    repeated CurrencySummary summaries = 1;
}