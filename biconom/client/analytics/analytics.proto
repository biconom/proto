syntax = "proto3";

package biconom.client.analytics;

import "biconom/types/chart.proto";
import "biconom/types/interval.proto";

// AnalyticsService предоставляет методы для получения аналитических данных, таких как графики.
service AnalyticsService {
    // Получает один график по его идентификатору и параметрам.
    rpc GetChart(GetChartRequest) returns (biconom.types.Chart);

    // Получает список графиков по их идентификаторам и параметрам в одном пакетном запросе.
    rpc GetCharts(GetChartRequest.List) returns (biconom.types.Chart.List);
}

// Запрос на получение одного графика.
message GetChartRequest {
    // 'List' представляет собой запрос на получение нескольких графиков.
    message List {
        repeated GetChartRequest items = 1;
    }

    // Логическое имя (идентификатор) графика (например, "income", "registrations").
    string chart_name = 1;

    // Произвольный строковый идентификатор, устанавливаемый клиентом.
    // Позволяет различать несколько запросов на один и тот же тип графика с разными параметрами.
    // Этот же идентификатор будет возвращен в ответе `biconom.types.Chart`.
    optional string custom_id = 2;

    // Идентификатор валюты. Если указан, запрашивается монетарный график (например, "income" для USDT).
    // Если не указан, запрашивается количественный график (например, "registrations").
    optional uint32 currency_id = 3;

    // 'ScopeOptions' определяет область видимости данных для графика.
    message ScopeOptions {
        // 'Id' представляет собой перечисление доступных областей видимости.
        enum Id {
            UNSPECIFIED = 0;
            // Только персональные данные.
            PERSONAL = 1;
            // Данные по команде (структуре) дистрибьютора.
            TEAM = 2;
            // Данные по всей компании.
            COMPANY_WIDE = 3;
        }

        // Выбранная область видимости данных.
        Id id = 1;

        // Максимальная глубина структуры, которую нужно включить в отчет (начиная с текущего пользователя).
        // Если не указана, включается вся доступная глубина.
        optional uint32 team_depth_limit = 2;

        // Включать ли персональные данные в отчет по команде.
        // Если true, в отчет будут включены данные текущего пользователя и его структуры.
        // Если false, в отчет будут включены только данные структуры (без данных пользователя).
        bool include_personal = 3;
    }

    // Область видимости данных для графика.
    ScopeOptions scope = 4;

    // Интервал агрегации данных (таймфрейм).
    biconom.types.Interval interval = 5;

    // Начало временного диапазона для запроса данных (Unix timestamp).
    uint32 timestamp_start = 6;

    // Конец временного диапазона для запроса данных (Unix timestamp).
    uint32 timestamp_end = 7;
}