# Модели: Транзакции

Этот документ описывает иерархическую модель данных, используемую для представления финансовых операций в системе.

## 1. Иерархия моделей

Финансовые операции строятся по следующей иерархии:

1.  **`TransactionGroup`**: Контейнер верхнего уровня. Объединяет несколько `Transaction`, относящихся к одной сложной бизнес-операции (например, обмен валюты, который включает списание одной валюты, зачисление другой и списание комиссии).
2.  **`Transaction`**: Представляет логическую операцию с одним активом. Например, перевод BTC. Каждая транзакция состоит из набора бухгалтерских проводок.
3.  **`TransactionEntry`**: Атомарная бухгалтерская проводка. Это либо дебет (`DEBIT`), либо кредит (`CREDIT`) по одному конкретному счету `Ledger`. Сумма дебетов и кредитов внутри одной `Transaction` всегда должна быть равна нулю (принцип двойной записи).

## 2. Описание моделей

### `TransactionGroup`
- **Назначение**: Группировка транзакций.
- **Поля**:
  - `id`: Уникальный идентификатор группы.
  - `created_at`: Время создания.
  - `transactions`: Список вложенных транзакций.

### `Transaction`
- **Назначение**: Описывает операцию с одним типом актива.
- **Поля**:
  - `id`, `group_id`: Идентификаторы.
  - `parent_transaction_id`: Для связи с родительской операцией (например, при сторнировании).
  - `asset`: Актив, с которым проводится операция.
  - `layer`: Слой исполнения (`PRIMARY`, `SCHEDULED`, `PAYMENT`).
  - `status`: Жизненный цикл транзакции (`PENDING`, `POSTED`, `REVERSED` и т.д.).
  - `entries`: Список вложенных проводок.

### `TransactionEntry`
- **Назначение**: Атомарная, неделимая и **неизменяемая** часть транзакции. Прямое отражение операции на счете `Ledger`. У проводки нет поля `updated_at`.
- **Поля**:
  - `id`, `transaction_id`, `ledger_id`: Идентификаторы.
  - `direction`: Направление (`DEBIT` или `CREDIT`).
  - `amount`: Сумма проводки.
  - `reason`: Контекст или причина (пока в виде `json`).
  - `note`: **Необязательное** текстовое примечание.

### `TransactionScopeId`
- **Назначение**: Универсальный идентификатор, который может указывать на любую сущность в иерархии (группу, транзакцию или проводку). Используется в запросах к `TransactionService` для указания области видимости.
