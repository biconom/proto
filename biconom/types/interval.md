# Модель: Interval

## 1. Описание

**`Interval`** — это универсальная встраиваемая модель, предназначенная для определения временных интервалов (таймфреймов) и часового пояса. Она используется в различных сервисах для запроса данных, агрегированных по времени, например, при построении графиков или аналитических отчетов.

## 2. Назначение и решаемые задачи

Основная цель модели — предоставить стандартизированный способ указания временного разрешения для агрегации данных.

### Ключевые задачи:
- **Унификация**: Определяет единый набор поддерживаемых временных интервалов (`MINUTE`, `HOUR`, `DAY` и т.д.), что обеспечивает консистентность во всем API.
- **Корректность агрегации**: Позволяет передавать идентификатор часового пояса в стандарте IANA (`timezone_id`), что критически важно для правильной группировки данных по дневным, недельным и месячным интервалам. Этот подход автоматически обрабатывает переход на летнее время (DST) и гарантирует, что "начало дня" всегда соответствует локальному времени пользователя.
- **Переиспользуемость**: Является независимой и может быть встроена в любой запрос, где требуется указание временного интервала.

## 3. Ключевые поля и концепции

- `enum Id`: Перечисление всех поддерживаемых системой временных интервалов.
  - `MINUTE`, `HOUR`, `DAY`, `WEEK_MONDAY_START`, `WEEK_SUNDAY_START`, `WEEK_SATURDAY_START`, `MONTH`, `YEAR`.
- `id`: Поле, в котором передается выбранный тип интервала из `enum Id`.
- `timezone_id`: Идентификатор часового пояса из базы данных IANA (TZ Database).
  - **Пример**: `"Europe/Moscow"`, `"America/New_York"`, `"UTC"`.
  - **Важность**: Это поле позволяет бэкенду правильно и однозначно определять границы дней, недель и месяцев в локальном времени пользователя, включая автоматическую обработку летнего времени.

## 4. Сценарии использования

- **Запрос часового графика**: Клиент формирует запрос на получение данных для графика и вкладывает в него объект `Interval` со значениями:
  - `id: HOUR`
  - `timezone_id: "UTC"` (или часовой пояс пользователя, например, `"Asia/Dubai"`).
- **Запрос дневного графика для пользователя в Нью-Йорке**: Клиент определяет часовой пояс пользователя и формирует объект `Interval`:
  - `id: DAY`
  - `timezone_id: "America/New_York"`
  Бэкенд, получив этот запрос, будет агрегировать данные так, чтобы каждая "свеча" графика начиналась и заканчивалась в полночь по времени Нью-Йорка, корректно учитывая все переходы на летнее время в запрошенном диапазоне.
- **Запрос дневного графика для пользователя в Дубае**: Клиент определяет часовой пояс пользователя и формирует объект `Interval`:
  - `id: DAY`
  - `timezone_id: "Asia/Dubai"`
  Бэкенд, получив этот запрос, будет агрегировать данные так, чтобы каждая "свеча" графика начиналась и заканчивалась в полночь по времени Дубая, корректно учитывая все переходы на летнее время в запрошенном диапазоне.

## 5. Связи с другими моделями

- **`Chart`**: Модель `Interval` может быть встроена в запрос на получение данных для графика, чтобы указать таймфрейм свечей.
- **Аналитические сервисы**: Любой сервис, возвращающий данные, сгруппированные по времени, может использовать `Interval` в качестве параметра запроса.