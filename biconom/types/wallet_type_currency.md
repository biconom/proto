# Модель: WalletTypeCurrency

## 1. Описание

**`WalletTypeCurrency`** — это связующая модель, которая определяет, что конкретная валюта (`Currency`) доступна в рамках определенного типа кошелька (`WalletType`). Ключевой особенностью этой модели является возможность задавать правила-исключения, которые переопределяют общие разрешения, установленные в `WalletType`.

Логическим ключом является пара (`wallet_type_id`, `currency_id`).

## 2. Назначение и решаемые задачи

Основная цель — предоставить гранулярный контроль над каждой валютой в каждом типе кошелька.

### Ключевые задачи:
- **Создание связи**: Декларирует, что валюта доступна в данном типе кошелька.
- **Управление исключениями**: Позволяет точечно запрещать операции для конкретной валюты, которые в целом разрешены для данного типа кошелька.

## 3. Ключевые поля и концепции

- `wallet_type_id`, `currency_id`: Составной ключ, идентифицирующий связь.
- `disabled`: "Мастер-выключатель". Если `true`, валюта полностью отключается в данном типе кошелька, и дальнейшие флаги не имеют значения.
- `disabled_operations_flags`: **Ключевое поле**. Это битовая маска, которая определяет, какие операции **запрещены** для данной валюты, даже если они разрешены в `WalletType`. Позиции битов в маске соответствуют значениям из `WalletOperation.Id`.

## 4. Сценарии использования

- **Временное отключение вывода новой валюты**: Для `WalletType` "SPOT" в целом разрешены выводы. Но для новой, недавно добавленной валюты "NEWCOIN" администратор хочет временно запретить вывод. Он создает запись `WalletTypeCurrency` для пары (SPOT, NEWCOIN) и в `disabled_operations_flags` устанавливает бит, соответствующий `WITHDRAW`. Все остальные операции для "NEWCOIN" остаются доступными.
- **Полное отключение валюты**: Если в сети Tron возникли проблемы, администратор может найти все записи `WalletTypeCurrency`, где `currency_id` соответствует TRX, и установить для них флаг `disabled = true`.

## 5. Связи с другими моделями

- **`WalletType`**: `WalletTypeCurrency` **является дочерней сущностью** и ссылается на `WalletType` через `wallet_type_id`.
- **`Currency`**: `WalletTypeCurrency` **ссылается** на `Currency` через `currency_id`.
- **`WalletOperation`**: `WalletTypeCurrency` **логически использует** перечисление `WalletOperation.Id` для определения позиций битов в поле `disabled_operations_flags`.