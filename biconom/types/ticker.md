# Модель: Ticker

## 1. Описание

**`Ticker`** — это модель-DTO (Data Transfer Object), которая представляет собой сводку рыночных данных для одной торговой пары на конкретной бирже. Это высокодинамичная модель, предназначенная для частых обновлений и трансляции клиентам в реальном времени.

Ключевая особенность `Ticker` — его гибкость. С помощью механизма `oneof rate_kind` он может представлять данные как от простого **обменника** с фиксированными курсами, так и от полноценной **биржи** со стаканом ордеров.

## 2. Назначение и решаемые задачи

Основная цель — отделить быстро меняющиеся рыночные данные от статичной конфигурации (`ExchangeCurrencyPair`) и предоставить клиентам единую модель для получения информации о курсах.

### Ключевые задачи:
- **Предоставление курсов**: Является основным источником информации о ценах для клиентских приложений.
- **Поддержка разных торговых моделей**: Позволяет системе одновременно работать с биржами-обменниками и классическими биржами.
- **Оптимизация производительности**: Как легковесная модель, `Ticker` идеально подходит для высокочастотной рассылки через стриминговые сервисы (`MarketDataService`).

## 3. Ключевые поля и концепции

- `id`: Составной ключ (`exchange_id`, `currency_pair_id`), который однозначно связывает тикер с торговой парой на бирже.
- `rate_kind`: `oneof`, который определяет тип предоставленных рыночных данных. Выбор конкретного типа (`exchanger_rate` или `market_rate`) зависит от поля `trading_model` в `ExchangePolicy` соответствующей биржи.
  - `exchanger_rate`: Используется для бирж с моделью `EXCHANGER`.
    - `buy_price`: Цена, по которой система **покупает** базовую валюту у пользователя.
    - `sell_price`: Цена, по которой система **продает** базовую валюту пользователю.
    - Поля являются `optional`, что позволяет представлять ситуации, когда доступна только покупка или только продажа.
  - `market_rate`: Используется для бирж с моделью `ORDER_BOOK`. Содержит стандартный набор биржевых данных: цена последней сделки, лучший bid/ask, объемы и т.д.

## 4. Сценарии использования

- **UI Обменника**: Клиент получает `Ticker` с заполненным полем `exchanger_rate` и отображает пользователю кнопки "Купить по X" и "Продать по Y".
- **Торговый терминал**: Клиент подписывается на поток `Ticker`-ов через `MarketDataService`. Для биржевых пар он получает `market_rate` и обновляет график цены, стакан и другую статистику.

## 5. Связи с другими моделями

- **`ExchangeCurrencyPair`**: `Ticker` логически связан с `ExchangeCurrencyPair` через общий `id`. `Ticker` предоставляет динамические данные, а `ExchangeCurrencyPair` — статическую конфигурацию.
- **`ExchangePolicy`**: Модель `ExchangePolicy` через поле `trading_model` определяет, какой `oneof` (`exchanger_rate` или `market_rate`) будет использоваться в `Ticker` для данной биржи.
- **`MarketDataService`**: Этот сервис является основным поставщиком моделей `Ticker`.

## 6. Интеграция с Квестами

Поле `quest` содержит объект `Quest.ExchangeTradeQuest`, если для данной пары активен какой-либо квест.

- **Доступ к данным**: Клиент проверяет наличие поля `quest`.
- **Этапы**: Список этапов доступен через `quest.stages`.
- **Контекст**: Тип `ExchangeTradeQuest` гарантирует наличие торговых условий.