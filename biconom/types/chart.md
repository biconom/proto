# Модель: Chart

## 1. Описание

**`Chart`** — это универсальная модель данных, предназначенная для представления аналитических графиков. Её ключевая особенность — полиморфизм, который позволяет использовать одну и ту же структуру для передачи данных как денежного (монетарного), так и количественного (числового) характера.

Эта модель является ответом на запросы в `AnalyticsService` и содержит всю необходимую информацию для визуализации графика на стороне клиента.

## 2. Назначение и решаемые задачи

Основная цель модели — предоставить стандартизированный и гибкий формат для аналитических данных.

### Ключевые задачи:
- **Унификация**: Создает единый контракт для всех типов графиков в системе, будь то график доходов, регистраций, активности пользователей и т.д.
- **Полиморфизм данных**: С помощью механизма `oneof` модель может содержать либо `monetary_data` (для денежных значений), либо `numeric_data` (для целочисленных значений), что избавляет от необходимости создавать отдельные, почти идентичные модели.
- **Высокая точность**: Для денежных значений (`Monetary.Candle`) используется строковый тип (`string`), чтобы избежать проблем с потерей точности при работе с числами с плавающей запятой.
- **Агрегированные данные**: Данные представлены в виде "свечей" (`Candle`), каждая из которых является результатом агрегации данных за определенный временной интервал (`timestamp_start`, `timestamp_end`).

## 3. Ключевые поля и концепции

- **`chart_name`**: Логическое имя-идентификатор графика (например, "income", "registrations"). Клиент использует это поле, чтобы сопоставить полученные данные с исходным запросом, особенно при пакетном получении нескольких графиков.

- **`oneof data_type`**: Механизм, обеспечивающий полиморфизм. Может принимать одно из двух значений:
  - **`monetary_data (Monetary)`**: Контейнер для данных денежного графика.
    - `currency_id`: Указывает, в какой валюте представлены данные.
    - `candles`: Список свечей, где `value` представлено в виде `string` для высокой точности.
  - **`numeric_data (Numeric)`**: Контейнер для данных количественного графика.
    - `candles`: Список свечей, где `value` является целочисленным значением `int64`.

- **`Candle` (Свеча)**: Представляет собой единичный элемент данных на графике, агрегированный за определенный интервал.
  - `timestamp_start` / `timestamp_end`: Временные метки Unix, определяющие границы интервала.
  - `value`: Значение для данного интервала.

- **`List`**: Вложенное сообщение, которое служит стандартной оберткой для возврата списка объектов `Chart` в пакетных ответах (например, от метода `AnalyticsService.GetCharts`).

## 4. Сценарии использования

### Сценарий 1: Получение графика дохода в USDT
- **Запрос**: Клиент запрашивает график с `chart_name: "income"` и `currency_id` для USDT.
- **Ответ**: Сервер вернет объект `Chart`, где:
  - `chart_name` будет "income".
  - `data_type` будет содержать `monetary_data`.
  - Внутри `monetary_data` будет указан `currency_id` для USDT и список свечей, у каждой из которых `value` будет строкой, например, `"1500.75"`.

### Сценарий 2: Получение графика новых регистраций
- **Запрос**: Клиент запрашивает график с `chart_name: "registrations"`.
- **Ответ**: Сервер вернет объект `Chart`, где:
  - `chart_name` будет "registrations".
  - `data_type` будет содержать `numeric_data`.
  - Внутри `numeric_data` будет список свечей, у каждой из которых `value` будет целочисленным значением, например, `120`.

## 5. Связи с другими моделями

- **`AnalyticsService`**: Является основным потребителем и производителем модели `Chart`. Методы `GetChart` и `GetCharts` возвращают экземпляры этой модели.
- **`Interval`**: Хотя `Interval` не является частью самой модели `Chart`, он используется в запросе (`GetChartRequest`) для определения, по какому временному интервалу должны быть агрегированы данные в свечах. В будущем `Interval` может быть добавлен в ответ `Chart` для явного указания таймфрейма.