# Модель: ExchangeCurrencyPair

## 1. Описание

**`ExchangeCurrencyPair`** — это операционная модель, которая является "мостом" между справочниками и реальной торговой логикой. Она связывает абстрактную валютную пару (`CurrencyPair`) с конкретной торговой площадкой (`Exchange`) и определяет детальные правила торгов: лимиты, комиссии и операционный статус.

## 2. Назначение и решаемые задачи

Основная цель — позволить гибко и гранулярно настраивать условия торговли для каждой пары на каждой бирже отдельно.

### Ключевые задачи:
- **Конкретизация торгов**: Определяет, что пара `BTC/USDT` действительно торгуется на бирже `SPOT_MARKET`.
- **Управление доступностью**: Поле `status` позволяет включать/отключать торги по конкретной паре на конкретной бирже, не затрагивая другие площадки.
- **Детальная настройка операций**: Модель `OperationSettings` позволяет задавать разные правила для покупки и продажи (например, разные лимиты или комиссии).
- **Гибкие комиссии**: Позволяет настроить комиссию как с базовой (`base_fee`), так и с котируемой (`quote_fee`) валюты. Например, при покупке BTC за USDT можно взять комиссию и в BTC, и в USDT.

## 3. Ключевые поля и концепции

- `id`: Составной ключ из `exchange_id` и `currency_pair_id`, однозначно идентифицирующий запись.
- `status`: Операционный статус пары на данной бирже (`ACTIVE`, `MAINTENANCE`).
- `buy_settings` / `sell_settings`: Два экземпляра вложенной модели `OperationSettings`, которые определяют правила для покупки и продажи базовой валюты соответственно.

### Модель `OperationSettings`
- `enabled`: Простой "рубильник" для включения/выключения операции.
- `min_amount` / `max_amount`: Лимиты на сумму одной операции, выраженные в **базовой валюте** пары. `optional` позволяет не устанавливать лимит.
- `base_fee` / `quote_fee`: Ссылки на `CalculationGroup` для расчета комиссий. Это позволяет, например, при сделке `BTC/USDT` взять 0.1% от суммы в USDT (`quote_fee`) и одновременно фиксированную комиссию в 0.00001 BTC (`base_fee`).

## 4. Сценарии использования

- **Настройка спотовой пары**: Для `BTC/USDT` на спотовой бирже в `buy_settings` и `sell_settings` устанавливается `enabled = true`, `min_amount = "0.0001"`, а в `quote_fee` задается комиссия 0.1% от суммы в USDT.
- **Промо-акция**: Для новой пары на P2P-бирже можно временно установить нулевые комиссии, передав пустые `CalculationGroup` в `base_fee` и `quote_fee`.
- **Технические работы**: Администратор меняет `status` на `MAINTENANCE`, чтобы временно остановить торги по паре на одной бирже, не затрагивая другие.

## 5. Связи с другими моделями

- **`Exchange`**: `ExchangeCurrencyPair` ссылается на `Exchange` через `id.exchange_id`.
- **`CurrencyPair`**: `ExchangeCurrencyPair` ссылается на `CurrencyPair` через `id.currency_pair_id`.
- **`CalculationGroup`**: `ExchangeCurrencyPair` **встраивает** эту модель для описания правил расчета комиссий.