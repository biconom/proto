syntax = "proto3";

package biconom.types;

import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";
import "biconom/types/presence.proto";
import "biconom/types/session_policy.proto";

// Session представляет собой активную сессию пользователя в системе.
message Session {
	// Статус жизненного цикла сессии.
	enum Status {
		UNSPECIFIED = 0;
		// Сессия активна и используется.
		ACTIVE = 1;
		// Сессия требует подтверждения (например, при входе с нового устройства).
		PENDING = 2;
		// Сессия была завершена пользователем (logout).
		CANCELLED = 3;
		// Сессия была принудительно завершена системой (например, при входе с нового устройства).
		REVOKED = 4;
		// Срок действия сессии истек (по времени или неактивности).
		EXPIRED = 5;
		// Принудительное завершение (система, модерация)
		TERMINATED = 6;
	}

	message Geoip {
		string ip_address = 1;			    // IP-адрес, с которого была создана сессия.
		optional string country_iso = 2;    // Код страны, полученное по IP.
		optional string country = 3;        // Название страны, полученное по IP.
		optional string city = 4;           // Название города, полученное по IP.
		repeated string subdivisions = 5;	// Название промежуточных регионов (Штат/область), полученное по IP.
	}

	message Id {
		uint64 id = 1;					// Глобальный ID сессии.
	}

	message List {
		repeated Session items = 1;
	}

	uint64 id = 1;
	Status status = 2;									// Текущий статус сессии.
	optional Geoip geoip = 3;                           // IP-адрес и geo данные.
	optional string os = 4;
	optional string device = 5;
	optional string browser = 6;

	uint64 trace_id = 7;
	uint32 policy_id = 8;								// Политика, управляющая правилами этой сессии.
	google.protobuf.Timestamp created_at = 9;
	google.protobuf.Timestamp updated_at = 10;
	biconom.types.Presence.Status presence_status = 11;
}
