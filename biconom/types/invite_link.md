# Модель: InviteLink

## 1. Описание

**`InviteLink`** — это модель, представляющая собой реферальную ссылку, которая используется для привлечения и регистрации новых участников в иерархическую структуру.

## 2. Назначение и решаемые задачи

Основная цель — создать гибкую и управляемую систему реферальных ссылок, поддерживающую как простые персональные, так и сложные коллективные сценарии.

### Ключевые задачи:
- **Идентификация**: Каждая ссылка имеет уникальный `invite_code`, который является частью URL.
- **Управление состоянием**: Поле `enabled` позволяет включать и отключать ссылку.
- **Определение владельца**: Поле `account_id` четко определяет, какой аккаунт создал и владеет этой ссылкой.
- **Реализация сложной логики**: Структура `pools` позволяет реализовывать коллективные ссылки с ротацией и лимитами.

## 3. Ключевые поля и концепции

- `invite_code`: Уникальный код, используемый в URL.
- `name`: Внутреннее имя ссылки для удобства создателя.
- `enabled`: `bool`, определяющий, активна ли ссылка.
- `account_id`: ID аккаунта-владельца.
- `pools`: Массив объектов `Pool`, который определяет логику работы ссылки. Если `pools` пуст, ссылка считается персональной и ведет к дистрибьютору владельца. Если не пуст — коллективной.

### Структура `Pool`
`Pool` представляет собой группу дистрибьюторов с определенными правилами:
- `cycle_limit`: Сколько раз можно пройти по всему списку дистрибьюторов в пуле.
- `entities`: Список дистрибьюторов в пуле.
  - `distributor_id`: ID дистрибьютора.
  - `usage_limit`: Сколько раз можно использовать этого дистрибьютора в рамках одного цикла.
- `cursor_*`: Поля, которые отслеживают текущее состояние ротации в пуле.

## 4. Вложенные сообщения

### `InviteLink.View`
Специальная структура для отображения. Содержит не только саму ссылку, но и связанные объекты, такие как `Account`, `Network`, `Distributor`, что избавляет клиент от необходимости делать дополнительные запросы.

## 5. Сценарии использования (кейсы)

- **Создание персональной ссылки**: Партнер создает ссылку, не заполняя поле `pools`. При регистрации по этой ссылке система будет использовать дистрибьютора, привязанного к `account_id` владельца.
- **Создание коллективной ссылки для команды**: Лидер команды создает ссылку и заполняет `pools`, добавляя дистрибьюторов своей команды и устанавливая лимиты. Система будет распределять новых участников между ними согласно правилам пула.

## 6. Связи с другими моделями

- **`Account`**: `InviteLink` **принадлежит** одному `Account`.
- **`Distributor`**: `InviteLink` **косвенно ссылается** на одного или нескольких `Distributor` через поле `account_id` (для персональных ссылок) или через структуру `pools` (для коллективных).
