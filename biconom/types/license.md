# Модель: License (Лицензии)

## 1. Описание

**`License`** — это модель, представляющая техническое право пользователя на использование конкретного функционала или сущности в системе (например, маркетингового слота). Она отделена от процесса оплаты (биллинга) и фокусируется на проверке прав доступа.

## 2. Структура модели

`License` является контейнером для вложенных типов: `Plan`, `Voucher`, `State`.

### 2.2. License.Plan (Тарифный план)
Описывает конкретные условия подписки на лицензию.
- `tree_id`: Ссылка на дерево (маркетинговую структуру), для которой действует план.
- `title`: Название плана (например, "Premium Monthly").
- `enabled`: Доступен ли план к покупке в данный момент.
- `duration`: Длительность расчетного периода в секундах (например, 2592000 для 30 дней).
- `price`: Стоимость, выраженная через универсальную модель `Price` (валюта + сумма).

### 2.3. License.Voucher (Ваучер)
Представляет собой снимок условий тарифного плана на момент покупки.
- `id`: Уникальный идентификатор ваучера.
- `slot_id`: Идентификатор слота, которому принадлежит ваучер.
- `duration`: Длительность периода (в секундах), зафиксированная на момент покупки.
- `price`: Стоимость, по которой был приобретён ваучер.
- `activated`: Булевый флаг, указывающий, был ли ваучер использован.
- `activated_at`: Временная метка активации.
- `created_at`: Дата выпуска ваучера.

### 2.4. License.State (Состояние)
Описывает текущий статус владения лицензией для конкретного объекта (слота).
- `status`: Текущий технический статус (см. ниже).
- `current_voucher_id`: Идентификатор текущего активного ваучера.
- `vouchers`: Список всех ваучеров, связанных с данной лицензией.

## 3. Статусы лицензии

- **`INACTIVE`**: Начальное состояние. Лицензия никогда не была ранее активирована для данного объекта.
- **`ACTIVE`**: Лицензия оплачена и предоставляет полный доступ.
- **`EXPIRED`**: Срок действия истек, доступ заблокирован.
- **`SUSPENDED`**: Доступ принудительно остановлен администратором (например, за нарушение правил), независимо от наличия оплаты.

## 4. Временные метки (Timestamps)

Правильная интерпретация дат критична для логики продления:

- **`activated_at`**: Момент самой первой активации лицензии для данного объекта. Не меняется при продлениях. Позволяет вычислять "стаж" владения.
- **`started_at`**: Дата начала **текущего** оплаченного периода. Обновляется при каждом продлении.
- **`expires_at`**: Дата окончания текущего периода. После этой даты лицензия переходит в `EXPIRED`.

## 5. Взаимодействие с другими моделями

- **`License.Plan`**: Лицензия выдается на основании выбранного тарифного плана.
- **`MarketingService`**: Использует `License.State` для проверки возможности начисления бонусов и активности слота в структуре.

## 6. Рекомендации по использованию

1. **Проверка доступа**: Для предоставления услуг всегда проверяйте `status`. Доступ разрешен, если статус `ACTIVE`.

---
*Документация актуальна для версии proto-файлов от 16 февраля 2026 г.*