# Модель: MarketingSlot

## 1. Описание

**`MarketingSlot`** — это агрегированная модель данных (Data Transfer Object), предназначенная для отображения интерфейса маркетинговой структуры. Она объединяет техническую иерархию, динамические состояния лицензий и данные владельцев в единый ответ.

## 2. Навигация и контекст

Модель поддерживает глубокую навигацию по дереву маркетинга с сохранением контекста авторизации:

- **`executor_slot_id`**: Идентификатор слота, под которым пользователь авторизован в системе. Это "домашний" узел пользователя.
- **`view_slot_id`**: Идентификатор слота, который просматривается в данный момент. При входе в раздел маркетинга он совпадает с `executor_slot_id`, но при переходе вглубь структуры по цепочкам `view_slot_id` меняется.
- **`breadcrumbs`**: Массив объектов `Breadcrumb`, представляющий собой путь навигации. Он описывает промежуточные слои иерархии от `executor_slot_id` до `view_slot_id`, позволяя пользователю быстро вернуться на любой уровень выше.

## 3. Структура данных текущего уровня

- **`view_chains`**: Список дочерних цепочек (ответвлений), доступных непосредственно у просматриваемого слота (`view_slot_id`). Каждая цепочка содержит информацию о входящих в неё слотах и накопленном доходе.
- **`slot_states`**: Список динамических состояний (`State`). Содержит информацию о лицензиях и подписках. 
  > **Примечание**: На данный момент сервер возвращает состояния как минимум для двух ключевых слотов: `root_slot_id` и `view_slot_id`.
  > **Примечание**: На данный момент сервер возвращает состояния как минимум для двух ключевых слотов: `executor_slot_id` и `view_slot_id`.

## 4. Гидратация данных (Data Hydration)

Для того чтобы клиент мог отрисовать дерево без дополнительных запросов к API, модель включает в себя дедуплицированные списки связанных сущностей:

- **`slots`**: Список объектов `Slot`. Каждый объект содержит технические параметры (позиция, уровень) и ссылку на `distributor_id`.
- **`distributors`**: Список дистрибьюторских учетных записей. Каждый объект содержит ссылку на `account_id` и владеет одним или несколькими объектами из списка `slots`.
- **`accounts`**: Список системных учетных записей (пользователей или сообществ), которые являются конечными владельцами дистрибьюторов.

## 5. Сценарий отображения (Frontend)

1. **Хлебные крошки**: Рендерятся на основе массива `breadcrumbs`.
2. **Центральный узел**: Данные для `view_slot_id` берутся из списков `slots` и `slot_states`.
3. **Дочерние ветки**: Для каждой цепочки из `view_chains` отображаются входящие в неё слоты, данные о которых подтягиваются из общего списка `slots`.
4. **Информация о владельцах**: При клике на любой слот в интерфейсе, его владелец мгновенно находится в списке `distributors` по `distributor_id`, а данные профиля — в списке `accounts` по `account_id`.

## 6. Связи с другими моделями

- **`biconom.types.Slot`**: Базовая модель позиции в дереве.
- **`biconom.types.License.State`**: Технический статус доступа (внутри `State`).
- **`biconom.types.Subscription.State`**: Статус биллинга (внутри `State`).
- **`biconom.types.Price`**: Используется для отображения доходов в цепочках.

## 7. Рекомендации по обработке

### На стороне клиента:
- Используйте `slot_id` как ключ для сопоставления объектов из `slots` и `slot_states`.
- Используйте `distributor_id` для связи слота с его владельцем из списка `distributors`.

---
*Документация актуальна для версии proto-файлов от 18 января 2026 г.*