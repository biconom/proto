# Модель: PaymentNetworkOperationSettings

## 1. Описание

**`PaymentNetworkOperationSettings`** — это встраиваемая модель, которая инкапсулирует технические параметры, специфичные для конкретного типа платежной сети (блокчейн, банк и т.д.). Она используется внутри `PaymentOperationSettings` для детализации настроек ввода и вывода средств.

## 2. Назначение и решаемые задачи

Основная цель — вынести глубоко технические и специфичные для типа платежной сети параметры из общих настроек операции, сделав конфигурацию более структурированной и расширяемой.

### Ключевые задачи:
- **Инкапсуляция**: Собирает в одном месте все параметры, которые нужны для взаимодействия с конкретной платежной сетью. Например, для блокчейна это количество подтверждений, поддерживаемые форматы адресов, стандарты токенов и т.д.
- **Полиморфизм и расширяемость**: С помощью `oneof kind` модель спроектирована для поддержки настроек разных типов платежных сетей. Это обеспечивает строгую типизацию и позволяет в будущем легко добавлять новые типы (например, `Bank`, `PaymentSystem`), не затрагивая родительские модели. В текущей версии реализована поддержка только для `Blockchain`.
- **Конфигурация**: Предоставляет бэкенду всю необходимую информацию для корректной обработки транзакций: от валидации адресов до определения момента финализации депозита.

## 3. Ключевые поля и концепции

- `oneof kind`: Определяет, для какого типа платежной сети предназначены настройки.
  - `blockchain`: Содержит параметры, специфичные для платежных сетей на основе блокчейна.
    - `required_confirmations`: Количество подтверждений платежной сети, после которого депозит считается успешным. Критически важный параметр для безопасности.
    - `finality_threshold`: Альтернативный механизм определения финализации, основанный на вероятности (используется в некоторых PoS-платежных сетях).
    - `memo_type`: Указывает, требуется ли для транзакций `memo` (или `tag`, `message`) и какого он типа (`NONE`, `TEXT`, `NUMBER`, `HASH`).
    - `supported_address_formats`: Список форматов адресов, которые валидны для данной платежной сети (например, `EVM_HEX`, `BASE58`). Позволяет проводить валидацию на стороне клиента и сервера.
    - `supported_contract_types`: Список специфичных для блокчейна типов контрактов или кошельков (например, `TON_V4R2`, `EVM_ERC20`), которые поддерживаются системой.
    - `supported_token_standards`: Список стандартов токенов, поддерживаемых в этой платежной сети (например, `ERC20`, `SPL`).
    - **Оптимизации**:
      - `supports_batching`: Флаг, указывающий на поддержку пакетной отправки (одна транзакция с несколькими получателями).
      - `supports_multi_batching`: Флаг, указывающий на поддержку мульти-пакетной отправки (одна бизнес-операция может породить несколько транзакций).
    - `native_currency_id`: ID нативной валюты платежной сети, которая используется для оплаты комиссий (газа).
    - `deposit_requisites`: **Ключевое поле для UI**. Если оно заполнено, это означает, что система использует централизованный адрес для депозитов. Содержит сам адрес, который нужно показать пользователю. Если поле `memo_type` при этом не `NONE`, клиент должен также запросить у пользователя `memo`.

## 4. Сценарии использования

- **Настройка депозитов для USDT в платежной сети Tron**: Администратор настраивает `PaymentNetworkCurrency` для пары (платежная сеть Tron, валюта USDT). В `deposit_settings` он указывает `network_settings`, где `kind` установлен в `blockchain`. Внутри `Blockchain` он задает `required_confirmations = 20`, `memo_type = NONE`, `supported_address_formats = [BASE58]`, `supported_token_standards = [ERC20]` (для TRC20) и `native_currency_id` для TRX.
- **Настройка депозитов для XRP**: Администратор настраивает пару (XRP Ledger, XRP). В `network_settings.blockchain` он указывает:
  - `memo_type = NUMBER` (т.к. XRP использует числовые Destination Tag).
  - `deposit_requisites.address` = "r...".
  Теперь клиентское приложение знает, что для пополнения XRP нужно показать пользователю адрес "r..." и обязательно запросить у него числовой `Destination Tag`.

## 5. Связи с другими моделями

- **`PaymentNetworkCurrency`**: `PaymentNetworkOperationSettings` **является встраиваемой частью** этой модели. Поле `network_settings` содержит экземпляр `PaymentNetworkOperationSettings`, детализируя технические аспекты связки "сеть-валюта".