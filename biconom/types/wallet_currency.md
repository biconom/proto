# Модель: WalletCurrency

## 1. Описание

**`WalletCurrency`** — это модель-DTO (Data Transfer Object), которая представляет собой подробное представление баланса одной конкретной валюты в одном из кошельков пользователя.

Ключевая особенность этой модели в том, что она объединяет **подтвержденный баланс** (средства, которые уже зачислены и доступны) с агрегированной информацией об **операциях в ожидании** (средства, которые находятся в процессе зачисления или списания).

## 2. Назначение и решаемые задачи

Основная цель — предоставить клиентскому приложению полную и наглядную картину финансового состояния пользователя по каждому активу.

### Ключевые задачи:
- **Отображение баланса**: Показывает подтвержденный, доступный для использования баланс (`balance`).
- **Информирование об ожидающих операциях**: Дает пользователю понимание, какие средства "в пути". Например, "Ожидается депозит на сумму X" или "Заморожено для вывода Y".
- **Агрегация**: Избавляет клиента от необходимости самостоятельно запрашивать и агрегировать десятки или сотни отдельных транзакций для отображения сводной информации.

## 3. Ключевые поля и концепции

- `id`: Составной идентификатор, состоящий из `wallet_type_id` и `currency_id`. Однозначно определяет баланс.
- `balance`: **Подтвержденный баланс**. Это "бухгалтерский" баланс, вычисленный на основе `Ledger`.
- `transactions_quantity`: Общее количество подтвержденных транзакций по этому балансу.
- `pending_internal_operations`: Сводка по внутренним операциям в ожидании (переводы между пользователями, начисление бонусов).
  - `incoming_pending`: Ожидаемые зачисления.
  - `outgoing_pending`: Ожидаемые списания (например, средства, заблокированные под отправку перевода).
- `pending_payment_network_operations`: Сводка по внешним операциям в ожидании (через платежные сети).
  - `deposits_pending`: Ожидающие депозиты, которые еще не набрали нужного количества подтверждений в сети.
  - `withdrawals_pending`: Выводы, которые были запрошены, но еще не отправлены или не подтверждены в сети.

## 4. Сценарии использования

- **UI кошелька**: Клиентское приложение получает объект `WalletCurrency` для BTC и отображает: "Доступно: **1.5 BTC**". Если поле `pending_payment_network_operations.deposits_pending` заполнено, оно также может показать: "В процессе: **+0.2 BTC**".
- **Расчет общего баланса**: Клиент может на своей стороне вычислить "общий" баланс как сумму `balance` и `pending_internal_operations.incoming_pending.total_amount`.

## 5. Связи с другими моделями

- **`Wallet`**: Логически связана с `Wallet` через поле `id.wallet_type_id`.
- **`Ledger` и `LedgerTransaction`**: `WalletCurrency` является **агрегацией** данных из этих моделей. Сервер вычисляет `balance` из `Ledger`, а `pending_*` — путем агрегации `LedgerTransaction` в статусе `PENDING`.