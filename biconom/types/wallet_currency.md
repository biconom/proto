# Модель: WalletCurrency

## 1. Описание

**`WalletCurrency`** — это модель-DTO (Data Transfer Object), которая представляет собой подробное представление баланса одной конкретной валюты в кошельке пользователя. Она выступает в роли обертки над бухгалтерским счетом (`Ledger`), добавляя к нему контекст кошелька.

## 2. Назначение и решаемые задачи

Основная цель — предоставить клиентскому приложению полную картину финансового состояния пользователя по конкретному активу в рамках одного кошелька.

### Ключевые задачи:
- **Предоставление полной информации о балансе**: Включает в себя объект `Ledger`, который содержит все балансовые показатели: проведенные, ожидающие и запланированные операции.
- **Управление операциями на уровне валюты**: Позволяет точечно отключать операции (депозиты, выводы) для конкретной валюты в кошельке пользователя через `disabled_operations_flags`.
- **Полная блокировка**: Поле `disabled` служит "мастер-выключателем", который имеет наивысший приоритет и полностью блокирует все операции с валютой в данном кошельке.
- **Идентификация**: Четко определяет, к какому типу кошелька и какой валюте относится данный баланс.

## 3. Ключевые поля и концепции

- `id`: Составной идентификатор, состоящий из `wallet_type_id` и `currency_id`. Однозначно определяет баланс.
- `ledger`: **Ключевое поле**. Вложенный объект `Ledger`, который является первоисточником всех данных о балансе.
- `disabled`: **"Мастер-выключатель"**. Если `true`, все операции с этой валютой в данном кошельке запрещены, независимо от других флагов и статусов.
- `disabled_operations_flags`: Битовая маска, позволяющая принудительно запретить операции для этой конкретной валюты в кошельке, даже если они разрешены на более высоких уровнях (`Wallet` или `WalletType`).
- `initialized`: Флаг, который показывает, был ли этот объект баланса создан в системе (`true`) или является значением по умолчанию (`false`).

## 4. Сценарии использования

- **UI кошелька**: Клиентское приложение получает объект `WalletCurrency` для BTC. Из вложенного `ledger` оно берет `posted_credit` и `posted_debit` для отображения доступного баланса, а также `pending_debit` и `pending_credit` для отображения средств "в процессе".
- **Полное отключение валюты в кошельке**: Администратор устанавливает `disabled = true`, чтобы немедленно заблокировать все операции с USDT в спотовом кошельке пользователя из-за рисков.
- **Частичное отключение (только вывод)**: Администратор хочет временно запретить только вывод USDT из-за проблем в сети. Он устанавливает бит `WITHDRAW` в поле `disabled_operations_flags`. Депозиты и внутренние переводы при этом продолжают работать.

## 5. Связи с другими моделями

- **`Wallet`**: Логически связана с `Wallet` через поле `id.wallet_type_id`.
- **`Ledger`**: `WalletCurrency` **содержит** в себе объект `Ledger`, являясь его оберткой.