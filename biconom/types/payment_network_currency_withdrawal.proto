syntax = "proto3";

package biconom.types;

import "biconom/types/payment_instrument.proto";
import "google/protobuf/timestamp.proto";

// PaymentNetworkCurrencyWithdrawal представляет собой заявку на вывод средств.
message PaymentNetworkCurrencyWithdrawal {
    // --- Вложенные типы ---

    message Id {
        uint64 id = 1;
    }

    message List {
        repeated PaymentNetworkCurrencyWithdrawal items = 1;
    }

    // Статус жизненного цикла заявки на вывод.
    message Status {
        enum Id {
            UNSPECIFIED = 0;
            // Заявка создана и ожидает подтверждения пользователя.
            PENDING_CONFIRMATION = 1;
            // Заявка подтверждена и ожидает обработки системой.
            PENDING_PROCESSING = 2;
            // Заявка находится в процессе выполнения (транзакция отправлена в сеть).
            PROCESSING = 3;
            // Заявка успешно выполнена.
            COMPLETED = 4;
            // Заявка отклонена (например, из-за ошибки валидации, недостатка средств).
            REJECTED = 5;
            // Заявка отменена пользователем.
            CANCELLED = 6;
            // Произошла ошибка во время обработки.
            FAILED = 7;
        }
		Id id = 1;
    }

    // Body содержит основные данные заявки на вывод, которые могут быть
    // использованы как для создания новой заявки, так и для представления существующей.
    message Body {
        // ID типа кошелька, с которого осуществляется вывод.
        uint32 wallet_type_id = 1;

        // ID платежной сети, через которую осуществляется вывод.
        uint32 payment_network_id = 2;
        // ID валюты для вывода.
        uint32 currency_id = 3;
        
        // Реквизиты для вывода.
        biconom.types.PaymentInstrument instrument = 4;

        // Сумма вывода.
        string amount = 5;

        // Опциональное поле Memo/Tag/Message, если оно требуется для транзакции.
        optional string memo = 6;

        // Флаг, указывающий, что комиссию нужно вычесть из суммы `amount`.
        // `true`: получатель получит `amount - fee`.
        // `false` (по умолчанию): получатель получит `amount`, а с баланса будет списано `amount + fee`.
        bool deduct_fee_from_amount = 7;

        // Флаг, указывающий, что реквизиты (`instrument`) нужно добавить в "белый список" (адресную книгу).
        bool add_to_whitelist = 8;

        // Имя для новой записи в "белом списке". Используется, только если `add_to_whitelist` = `true`.
        optional string new_destination_name = 9;
    }

    // --- Поля основного сообщения ---

    uint64 id = 1; // Уникальный ID заявки на вывод.
    Status status = 2; // Текущий статус заявки.
    Body body = 3; // Тело заявки с деталями вывода.

    // ID связанной транзакции, которая будет создана после успешной обработки.
    optional uint64 transaction_id = 4;

    google.protobuf.Timestamp created_at = 5;
    google.protobuf.Timestamp updated_at = 6;
}