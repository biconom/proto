syntax = "proto3";

package biconom.types;

import "google/protobuf/timestamp.proto";
import "biconom/types/price.proto";

// License представляет собой право на использование конкретного функционала или сущности.
message License {

    // Plan описывает конкретные условия подписки на лицензию.
    message Plan {
        message Id {
            uint32 tree_id = 1;
        }

        message List {
            repeated Plan items = 1;
        }

        uint32 tree_id = 1; // Идентификатор дерева, к которой относится план
        string title = 2; // Название плана (например, "Premium Monthly")
        bool enabled = 3; // Доступен ли план к покупке в данный момент
        uint32 duration = 4; // Длительность расчетного периода (биллинг-цикла) в секундах
        biconom.types.Price price = 5; // Стоимость подписки за один период
    }

    // Voucher представляет собой предоплаченный, но еще не активированный тарифный план.
    message Voucher {
        message List {
            repeated Voucher items = 1;
        }

        uint32 id = 1; // Идентификатор ваучера
        uint32 slot_id = 2; // Идентификатор слота, которому принадлежит ваучер
        uint32 duration = 3; // Длительность периода действия ваучера (в секундах)
        biconom.types.Price price = 4; // Стоимость, по которой был приобретён ваучер
        bool activated = 5; // Флаг активации
        optional google.protobuf.Timestamp activated_at = 6; // Дата активации (заполняется при activated=true)
        google.protobuf.Timestamp created_at = 7; // Дата создания ваучера
    }

    // State содержит информацию о текущем динамическом состоянии лицензии.
    message State {
        enum Status {
            UNSPECIFIED = 0;
            INACTIVE = 1; // Начальное состояние (лицензия никогда не активировалась)
            ACTIVE = 2;   // Активная
            EXPIRED = 3;  // Срок действия завершен
            SUSPENDED = 5;    // Заблокирована административно (остановлена)
        }
        Status status = 1;
        uint32 current_voucher_id = 2; // Идентификатор текущего активного ваучера
        repeated Voucher vouchers = 3; // Список ваучеров, связанных с лицензией
        optional google.protobuf.Timestamp activated_at = 4;      // Момент самой первой активации
        optional google.protobuf.Timestamp started_at = 5;        // Начало текущего оплаченного периода
        optional google.protobuf.Timestamp expires_at = 6;        // Конец текущего оплаченного периода
    }
}