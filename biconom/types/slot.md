# Модель: Slot

## 1. Описание

**`Slot`** — это базовая модель, представляющая собой ячейку или позицию в иерархической структуре (дереве). Каждый слот жестко привязан к конкретному дистрибьютору (`Distributor`) и является атомарной единицей маркетинговой сети.

## 2. Назначение и решаемые задачи

Модель используется для визуализации и расчета партнерских структур.

### Ключевые задачи:
- **Позиционирование**: Определение точного места в дереве через `parent_id`, `level` и `parent_branch_number`.
- **Статистика структуры**: Хранение данных о заполненности и глубине поддерева (`structure_quantity`, `structure_level_max`).
- **Идентификация связей**: Определение отношения текущего пользователя к данному слоту через `relationship_state`.

## 3. Ключевые поля и концепции

- **`id`**: Глобальный уникальный идентификатор слота.
- **`distributor_id`**: Ссылка на владельца слота.
- **`parent_branch_number`**: Номер ветки (позиции) относительно родительского слота.
- **`level`**: Глубина залегания слота в глобальной иерархии.
- **`children_quantity`**: Текущее количество прямых дочерних слотов (первая линия).
- **`children_capacity`**: Максимально возможная ширина первой линии (вместимость для дочерних слотов).
- **`relationship_state`**: Встраиваемая модель `Relationship.State`. Позволяет фронтенду мгновенно понять, является ли просматриваемый слот частью команды пользователя (`TEAM`), вышестоящим спонсором (`UPLINE`) или самим пользователем (`PERSONAL`).

## 4. Сценарии использования

- **Отрисовка дерева**: При получении списка слотов клиент использует `parent_id` и `parent_branch_number` для корректного размещения узлов на канвасе или в списке.
- **Валидация действий**: Поле `relationship_state` используется для разграничения прав доступа (например, запрет на просмотр детальной статистики слотов, не входящих в `TEAM`).

## 5. Связи с другими моделями

- **`Distributor`**: Слот всегда принадлежит одному дистрибьютору.
- **`Relationship.State`**: Используется для описания иерархического контекста.
- **`MarketingSlot`**: Является частью агрегированной модели данных в маркетинговом сервисе.

## 6. Рекомендации по обработке

### На стороне клиента:
При получении объекта `Slot` в составе `MarketingSlot`, используйте `relationship_state` для визуального выделения различных типов связей (например, разные цвета для своей команды и вышестоящих).

### На стороне сервера:
Поля `structure_quantity` и `structure_level_max` должны обновляться асинхронно или через триггеры при добавлении новых дочерних элементов, чтобы обеспечить быструю выборку статистики без рекурсивных запросов.

---
*Документация актуальна для версии proto-файлов от 18 января 2026 г.*