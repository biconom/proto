# Модель: PaymentDestination

## 1. Описание

**`PaymentDestination`** — это модель, представляющая собой одну запись в "адресной книге" пользователя. Она хранит статичные, переиспользуемые реквизиты получателя средств (назначение платежа).

Название подчеркивает, что модель хранит только статичную часть реквизитов (куда отправить), а не полные данные для конкретной транзакции (которые могут включать, например, одноразовый `memo`).

## 2. Назначение и решаемые задачи

Основная цель — предоставить стандартизированный и безопасный способ хранения пользовательских реквизитов для вывода средств.

### Ключевые задачи:
- **Строгая типизация**: С помощью `oneof instrument_details` модель гарантирует, что каждая запись содержит реквизиты только одного типа (например, `Blockchain`).
- **Управление жизненным циклом**: Поле `status` позволяет архивировать реквизиты, убирая их из активного использования без физического удаления ("мягкое удаление").
- **Пользовательское описание**: Поле `name` позволяет пользователю дать удобное название для каждого сохраненного реквизита.
- **Гибкость и переиспользование**: Модель хранит реквизиты (например, адрес кошелька) независимо от конкретной платежной сети, указывая только их технический формат. Это позволяет использовать один и тот же сохраненный адрес для вывода в разные, но совместимые сети.

## 3. Ключевые поля и концепции

- `id`: Уникальный идентификатор записи в реестре.
- `name`: Человекочитаемое имя, заданное пользователем (например, "Мой ETH кошелек").
- `status`: Статус записи. Имеет тип `Status.Id`, где `Status` — это сообщение-обертка, а `Id` — само перечисление (`UNSPECIFIED`, `ACTIVE`, `ARCHIVED`).
  - `ACTIVE`: Запись активна и будет отображаться в списках.
  - `ARCHIVED`: Запись архивирована. Она не будет возвращаться в общих списках по умолчанию, но ее можно запросить по ID.
- `InstrumentType`: Перечисление, которое классифицирует тип инструмента (`BLOCKCHAIN`, `BANK_ACCOUNT` и т.д.). Используется для установки лимитов в `PaymentDestinationRegistry`.
- `oneof instrument_details`: Содержит конкретную структуру с техническими реквизитами.
  - `blockchain`: Структура для реквизитов блокчейн-транзакции.
    - `address_format`: Формат адреса (например, `EVM_HEX`, `BASE58`). **Ключевое поле**, которое позволяет системе определить, для каких платежных сетей этот адрес является валидным.
    - `address`: Адрес.
    - Поле `memo` (или Tag) намеренно отсутствует. Оно является специфичным для транзакции и должно запрашиваться у пользователя в момент создания вывода, а не храниться вместе с адресом.

## 4. Сценарии использования

- **Добавление универсального EVM-адреса**: Пользователь сохраняет свой Ethereum-кошелек. Создается `PaymentDestination` с `name="Мой EVM кошелек"`, `status=ACTIVE`. В `instrument_details` указывается `blockchain` с `address_format = EVM_HEX` и самим адресом. Теперь, когда пользователь инициирует вывод в платежную сеть Ethereum, BSC или Polygon (которые все поддерживают `EVM_HEX`), система предложит ему эту запись как валидный вариант.
- **Архивация старого адреса**: Пользователь больше не использует старый адрес. Он не удаляет его (чтобы сохранить историю операций), а меняет его `status` на `ARCHIVED`. Адрес пропадает из активных списков для вывода.

## 5. Связи с другими моделями

- **`PaymentDestinationRegistry`**: `PaymentDestination` **является элементом** списка `entries` в реестре `PaymentDestinationRegistry`.
- **`PaymentNetworkOperationSettings`**: `PaymentDestination.Blockchain` **использует** перечисление `AddressFormat.Id` из этой модели для типизации формата адреса.
- **`PaymentNetwork`**: Прямой связи нет. Связь является **логической** и устанавливается во время операции вывода: система сопоставляет `PaymentDestination.Blockchain.address_format` со списком `supported_address_formats` из настроек выбранной `PaymentNetwork`.
